# Atom Messenger API

## Описание

**Atom Messenger API** — это серверная часть мессенджера, разработанная с использованием FastAPI и SQLAlchemy. Приложение предоставляет функционал для управления пользователями, чатами и сообщениями, а также поддержку WebSocket для обмена сообщениями в реальном времени.

## Особенности

- Регистрация и аутентификация пользователей с использованием JWT токенов.
- Управление чатами: создание, удаление, получение списка чатов.
- Отправка, редактирование и удаление сообщений.
- WebSocket соединения для чатов в реальном времени.
- Роли пользователей (администратор, пользователь).

## Установка

Клонируйте репозиторий:

```bash
git clone https://github.com/VanillaFroggy/atom-messenger-api.git
cd atom-messenger-api
```

Создайте виртуальное окружение:

```bash
python -m venv venv
source venv/bin/activate  # Для Windows: venv\Scripts\activate
```

Установите зависимости:

```bash
pip install -r requirements.txt
```

Настройте переменные окружения:

Создайте файл .env в корне проекта и укажите следующие переменные:

```bash
DATABASE_URL=postgresql+psycopg2://user:password@localhost:5432
```

Откройте проект в PyCharm, после чего установите соединение с базой данных через встроенные в IDE инструменты, чтобы ORM создала все нужные таблицы за Вас, не забудьте перед этим скачать драйвер, который рекомендуте IDE.
Стоит уточнить, что базу данных для тестов test_db стоит создать вручную через тот же инструментарий IDE.

Запустите сервер:

```bash
uvicorn main:app --reload
```
Сервер будет доступен по адресу: http://127.0.0.1:8000.

## Развёртывание в Docker
Приложение поддерживает развёртывание через Docker Compose.

Убедитесь, что у вас установлены Docker и Docker Compose.

Настройте файл .env: Укажите переменные окружения для базы данных:

```makefile
DATABASE_USER=user
DATABASE_PASSWORD=password
DATABASE_NAME=chat_db
DATABASE_URL=postgresql+psycopg2://user:password@db:5432
```
Соберите и запустите контейнеры:

```bash
docker-compose up --build
```
Это создаст два контейнера:

- db: для PostgreSQL
- app: для API

Сервер будет доступен по адресу: http://localhost:8000.

## Эндпоинты

##### Пользователи
- POST /register/ — регистрация пользователя.
- POST /authenticate/ — аутентификация пользователя.
- GET /getUserById/{user_id} — получение информации о пользователе.
##### Чаты
- POST /createChat — создание чата.
- GET /getChatList/{user_id} — получение списка чатов пользователя.
- GET /getChatById/{chat_id} — получение чата по ID.
- DELETE /deleteChat/{chat_id} — удаление чата.
##### Сообщения
- POST /sendMessage — отправка сообщения.
- GET /getMessageList/{chat_id} — получение списка сообщений чата.
- PUT /editMessage — редактирование сообщения.
- DELETE /deleteMessage/{message_id} — удаление сообщения.
##### WebSocket
- ws://127.0.0.1:8000/ws/chat/{chat_id} — WebSocket для чата.

Если данной документации по эндпоинтам недостаточно, запустите приложение, и перейдите по ссылке:
http://localhost:8000/docs или http://localhost:8000/redoc 

## Структура проекта

```bash
atom-messenger-api/
│
├── app/
│   ├── __init__.py
│   ├── auth.py           # Аутентификация и управление JWT
│   ├── db.py             # Конфигурация базы данных
│   ├── dtos.py           # DTO для взаимодействия с клиентом
│   ├── initialize_db.py  # Инициализация базы данных (создание администратора)
│   ├── main.py           # Основной файл приложения
│   ├── models.py         # SQLAlchemy модели
│   └── service.py        # Логика приложения
│
├── test/                # Тесты
│   └── test_main.py      # Тестирование эндпоинтов
│
├── .env                  # Файл с переменными окружения
├── .env.example          # Файл с примером переменных окружения
├── docker-compose.yml    # Файл с иструкциями для сборки и развёртывания
│                         # приложения с базой данных в Docker-контейнерах
├── Dockerfile            # Файл с инструкциями для сборки
│                         # Docker-образа приложения
├── pytest.ini            # Конфигурационный файл для pytest
├── requirements.txt      # Список зависимостей
└── README.md             # Документация
```

## Тестирование

Для запуска тестов выполните команду:

```bash
pytest test
```

Тесты находятся в директории test/ и покрывают основные эндпоинты и функционал приложения.